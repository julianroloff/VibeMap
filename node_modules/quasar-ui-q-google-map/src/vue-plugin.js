// import Component from './components/Component'
// import *  as a from './index.common'
import Vue from 'vue'
import Map from './components/map.vue'

import {version} from '../package.json'
import loadGmapApi from './init/initializer'
// import QGoogleMap from './components/QGoogleMap.vue'
import promiseLazyFactory from './factories/promise-lazy'

import KmlLayer from './components/kml-layer'
import Marker from './components/marker'
import Polyline from './components/polyline'
import Polygon from './components/polygon'
import Circle from './components/circle'
import Rectangle from './components/rectangle'

// Vue component imports
import InfoWindow from './components/info-window.vue'
import StreetViewPanorama from './components/street-view-panorama.vue'
import PlaceInput from './components/place-input.vue'
import Autocomplete from './components/autocomplete.vue'

import MapElementMixin from './mixins/map-element'
import MapElementFactory from './factories/map-element'
import MountableMixin from './mixins/mountable'


// const version = __UI_VERSION__

let GmapApi = null;

export {
    Map
}


function install(app, options) {

    options = JSON.parse(process.env.options);

    options = {
        installComponents: true,
        autobindAllEvents: false,
        ...options
    }

    GmapApi = {data: {gmapApi: null}}

    // const defaultResizeBus = new Vue()
    // const defaultResizeBus = {}

    // Use a lazy to only load the API when
    // a VGM component is loaded
    const promiseLazyCreator = promiseLazyFactory(loadGmapApi, GmapApi)
    const gmapApiPromiseLazy = promiseLazyCreator(options)

    // app.config.globalProperties.$gmapDefaultResizeBus = defaultResizeBus
    app.config.globalProperties.$gmapOptions = options
    app.config.globalProperties.$gmapApiPromiseLazy = gmapApiPromiseLazy


    app.config.globalProperties.$gmapApiPromiseLazy = gmapApiPromiseLazy

    if (options.installComponents) {
        app.component('QGoogleMap', Map);
        app.component('QGoogleMapMarker', Marker)
        app.component('QGoogleMapPolygon', Polygon)
        app.component('QGoogleMapInfoWindow', InfoWindow)
        app.component('QGoogleMapPolyline', Polyline)
        app.component('QGoogleMapCircle', Circle)
        app.component('QGoogleMapRectangle', Rectangle)
        app.component('QGoogleMapKmlLayer', KmlLayer)

        app.component('QGoogleMapAutocomplete', Autocomplete)
        app.component('QGoogleMapPlaceInput', PlaceInput)
        app.component('QGoogleMapStreetViewPanorama', StreetViewPanorama)
    }

}

export {
    // version,
    version,
    loadGmapApi
    , KmlLayer, Marker, Polyline, Polygon, Circle, Rectangle,
  InfoWindow, PlaceInput, MapElementMixin, MapElementFactory, Autocomplete,
  MountableMixin, StreetViewPanorama,
    install,

}
